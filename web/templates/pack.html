<!DOCTYPE html>
<html>
<head>
	<title>Pack - {{ pack.name }}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    {% load static %}

</head>
<body class="container my-4 bg-dark text-light">


	<h1 class="text-center mb-4">{{ pack.name }} contains {{ pack.song_count }} songs</h1>

    <div class="row mb-4">
        <div class="col-md-4 text-center">
            {% if pack.banner %}
                <img class="img-fluid rounded" src="/media/images/packs/{{ pack.banner }}" alt="{{ pack.name }}">
            {% else %}
                <img class="img-fluid rounded" src="/media/images/packs/nobanner.png" alt="No banner available">
            {% endif %}
            <ul class="list-group mt-3">
                <li class="list-group-item bg-dark text-light"><strong>Number of Songs:</strong> {{ pack.song_count }}</li>
                <li class="list-group-item bg-dark text-light"><strong>Number of Charts:</strong> {{ chart_info.count }}</li>
                <li class="list-group-item bg-dark text-light"><strong>Difficulty Range:</strong> {{ chart_info.min_meter }} - {{ chart_info.max_meter }}</li>
                <li class="list-group-item bg-dark text-light"><a href="/downloads/packs/{{ pack.name }}.zip"><strong class="bi bi-download"></strong></a><br><strong><a href="mirrorlink/simfiles/{{ pack.name }}.zip">Mirror</a></strong></li>
            </ul>
        </div>
        <div class="col-md-8">
            <canvas id="difficultyGraph" width="400" height="150"></canvas>
        </div>
    </div>

    <div class="table-responsive">
    <table id="songTable" class="table table-striped table-hover table-bordered table-dark">
        <thead class="table-dark">
        <tr>
            <th>Banner</th>
            <th>Title</th>
            <th>Artist</th>
            <th>Subtitle</th>
            <th>Song Length</th>
            <th>Credit</th>
            <th>Chart Types</th>
		    <th>Meter Range</th>
        </tr>
        </thead>
        <tbody>
        {% for song in songs %}
        <tr>
		    <td class="text-center">{% if song.banner %}<img class="img-fluid rounded" style="max-height:100px;" src="/media/images/songs/{{ song.banner }}">
			{% elif song.pack.banner %}<img style="max-height:100px;" class="img-fluid rounded" src="/media/images/packs/{{ song.pack.banner }}">
			{% else %}<img class="img-fluid rounded" style="max-height:100px;" src="/media/images/packs/nobanner.png"></td>
			{% endif %}
		    </td>
		    <td class="small text-center"><a href="/song/{{ song.id }}">{{ song.title|slice:":64" }}{% if song.title|length > 64 %}...{% endif %}</a></td>
                    <td class="small text-center">{{ song.artist|slice:":64" }}</td>
		    <td class="small text-center">{{ song.subtitle|slice:":64" }}</td>
		    <td class="small text-center">{{ song.song_length_formatted }}</td>
		    <td class="small text-center">{% for credit in song.credit %}{{ credit }}<br>{% endfor %}</td>
		    <td class="text-center" width="150px">{% if song.charts.all %}{% load filters %}
			    {% for chart in song.charts.all|charttypes %}
			    <img data-bs-toggle="tooltip" data-bs-placement="top" title="{{ chart }}" class="img-fluid d-inline-block me-2" style="max-width: 50px; filter: invert(0);" src="{% static 'images/styles/'|add:chart|add:'.png' %}" alt="{{ chart }}">
			{% endfor %}{% endif %}
		    </td>
		    <td class="small text-center">
            {% if song.charts.all %}
			    {% if song.min_meter != song.max_meter %}
			    	{{ song.min_meter }}-{{ song.max_meter }}
				{% else %}
					{{ song.min_meter }}
				{% endif %}
            {% else %}
            <span class="text-muted">No charts available</span>
            {% endif %}
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="7" class="text-center">No songs available.</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

</body>
</html>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    $(document).ready(function() {
        $('#songTable').DataTable({
            paging: true,         // Enable pagination
            searching: true,      // Enable search
            ordering: true,       // Enable sorting
            pageLength: 25,       // Default rows per page
            lengthMenu: [25, 50, 100, 200], // Options for rows per page
            language: {
                search: "üîç Search Songs:", // Custom search placeholder
                lengthMenu: "Show _MENU_ songs per page",
                info: "Showing _START_ to _END_ of _TOTAL_ songs",
                infoEmpty: "No songs found",
                paginate: {
                    previous: "‚Üê Previous",
                    next: "Next ‚Üí"
                }
            }
        });
    });
    data: [{x: 10, y: 20}, {x: 15, y: null}, {x: 20, y: 10}]

        var ctx = document.getElementById('difficultyGraph').getContext('2d');
        var difficultyGraph = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: [{% for key, value in meter_dist.items %}{{ key }}, {% endfor %}]
                ,
                datasets: [{
                    label: 'Difficulty Distribution',
                    data: [{% for key, value in meter_dist.items %}{{ value }}, {% endfor %}],
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Chart Count',
                            color: '#e0e0e0'
                        },
                        ticks: {
                            color: '#e0e0e0'
                        },
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Meter',
                            color: '#e0e0e0'
                        },
                        ticks: {
                            color: '#e0e0e0'
                        }
                    }
                },
                plugins: {
                    legend: {
                        labels: {
                            color: '#e0e0e0'
                        }
                    }
                }
            }
        });

        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        tooltipTriggerList.forEach(function (tooltipTriggerEl) {
            new bootstrap.Tooltip(tooltipTriggerEl, {
                delay: { show: 0, hide: 100 }
            });
        });
</script>

